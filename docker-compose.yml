version: '3.8'

services:
  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    ports:
      - "3030:8080"  # Map to 3030 locally to avoid conflicts
    volumes:
      - ./api:/app
      - ./web:/web
    environment:
      - FLY_API_TOKEN=${FLY_API_TOKEN}
      - SPRITES_ORG_SLUG=${SPRITES_ORG_SLUG}
      - PORT=8080
      - WEB_PATH=/web
    restart: unless-stopped
    command: sh -c "cd /app && ./doze"

  # Nginx for serving web UI (optional, for production-like setup)
  # For MVP, API server can serve the HTML directly
  # web:
  #   image: nginx:alpine
  #   ports:
  #     - "3031:80"
  #   volumes:
  #     - ./web:/usr/share/nginx/html:ro
