services:
  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    ports:
      - "3030:8080"  # Map to 3030 locally to avoid conflicts
    volumes:
      # Mount web UI (read-only)
      - ./web:/web:ro
      # Don't mount ./api - it overwrites the built binary
    environment:
      - FLY_API_TOKEN=${FLY_API_TOKEN:-}
      - SPRITES_ORG_SLUG=${SPRITES_ORG_SLUG:-personal}
      - PORT=8080
      - WEB_PATH=/web
    restart: unless-stopped

  # Nginx for serving web UI (optional, for production-like setup)
  # For MVP, API server can serve the HTML directly
  # web:
  #   image: nginx:alpine
  #   ports:
  #     - "3031:80"
  #   volumes:
  #     - ./web:/usr/share/nginx/html:ro
